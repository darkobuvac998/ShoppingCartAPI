
node {
    stage('Run parallel') {
      parallel {
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
        buildStageDynamically('Test stage').call()
      }
    }
}

def buildStageDynamically(stageName) {
  return {
    stage("${stageName}") {
      node {
        label 'dotnet-agent'
      }

      sh 'echo Hello'
    }
  }
}
