
node {
  stage('Run parallel') {
    parallel admin: {
      buildStageDynamically('test').call()
    },
    test: {
      buildStageDynamically('test').call()
    }
  }
}

def buildStageDynamically(stageName) {
  return {
    stage("${stageName}") {
      node {
        label 'dotnet-agent'
      }

      sh 'echo Hello'
    }
  }
}

